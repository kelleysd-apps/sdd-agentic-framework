# Refinement Engine Configuration
# DS-STAR Multi-Agent Enhancement - Feature 001
# Constitutional Principle IV: Idempotent Operations
# All refinement loops have hard limits to prevent infinite loops

# ===================================================================
# Refinement Loop Configuration
# ===================================================================

# Maximum number of refinement rounds before escalation to human
MAX_REFINEMENT_ROUNDS=20

# Early stopping threshold (0.0-1.0)
# Stop refinement if quality score exceeds this threshold
EARLY_STOP_THRESHOLD=0.95

# Enable feedback accumulation across iterations
# Allows learning from previous failures
FEEDBACK_ACCUMULATION=true

# State persistence path (relative to repository root)
# Stores iteration state, feedback, and progress
STATE_PERSISTENCE_PATH=".docs/agents/shared/refinement-state/"

# ===================================================================
# Quality Thresholds (per workflow phase)
# ===================================================================

# Specification phase quality threshold
# Minimum score required to pass verification gate
SPEC_COMPLETENESS_THRESHOLD=0.90

# Planning phase quality threshold
# Ensures design meets constitutional requirements
PLAN_QUALITY_THRESHOLD=0.85

# Implementation phase quality threshold
# Code must meet this score to proceed
CODE_QUALITY_THRESHOLD=0.80

# Test coverage threshold (matches Constitutional Principle II)
# Minimum code coverage percentage required
TEST_COVERAGE_THRESHOLD=0.80

# ===================================================================
# Router Configuration
# ===================================================================

# Enable parallel execution optimization
# Router will identify tasks that can run concurrently
ENABLE_PARALLEL_EXECUTION=true

# Maximum number of agents to run in parallel
# Limits concurrent resource usage
MAX_PARALLEL_AGENTS=3

# Routing strategy: adaptive | sequential | parallel
# - adaptive: Router decides based on task analysis
# - sequential: Force sequential execution (debug mode)
# - parallel: Maximize parallelization (fast mode)
ROUTING_STRATEGY="adaptive"

# ===================================================================
# Auto-Debug Configuration
# ===================================================================

# Maximum debug iteration attempts before escalation
# Prevents infinite debug loops
MAX_DEBUG_ITERATIONS=5

# Enable automatic debugging
# If false, all errors escalate to human immediately
AUTO_DEBUG_ENABLED=true

# Debug logging level: basic | detailed | verbose
# Controls how much information is logged during debugging
DEBUG_LOG_LEVEL="detailed"

# Auto-fix success rate target (0.0-1.0)
# FR-016: Target >70% automatic fix rate for common errors
AUTO_FIX_TARGET_RATE=0.70

# ===================================================================
# Context Retrieval Configuration
# ===================================================================

# Embedding model for semantic similarity
# sentence-transformers model: all-MiniLM-L6-v2 (384-dim)
EMBEDDING_MODEL="sentence-transformers/all-MiniLM-L6-v2"

# Context cache size (number of entries)
# Caches embeddings for frequently accessed specs/plans
CONTEXT_CACHE_SIZE=100

# Similarity threshold for semantic matching (0.0-1.0)
# Lower = more results, Higher = more precise
SIMILARITY_THRESHOLD=0.70

# Top-K results to return from semantic search
# FR-031: Context retrieval must complete in <2 seconds
TOP_K_RESULTS=5

# Enable graceful degradation to TF-IDF if embeddings slow
# Falls back to keyword-based search if semantic search >2s
ENABLE_GRACEFUL_DEGRADATION=true

# Performance timeout for context retrieval (milliseconds)
# FR-031: <2 second requirement
CONTEXT_RETRIEVAL_TIMEOUT=2000

# ===================================================================
# Finalizer Configuration
# ===================================================================

# Enforce pre-commit constitutional checks
# Blocks commits that violate any of 14 principles
ENFORCE_PRE_COMMIT_CHECKS=true

# Automatically format code before commit (black, isort)
# Applied only if finalizer validation passes
AUTO_FORMAT_CODE=true

# Generate missing documentation automatically
# Creates/updates CLAUDE.md, README, API docs as needed
GENERATE_DOCS=true

# First-time pass rate target (0.0-1.0)
# FR-045: Target >95% passing finalizer checks first time
COMPLIANCE_FIRST_TIME_PASS_TARGET=0.95

# ===================================================================
# Metrics & Observability Configuration
# ===================================================================

# Enable structured logging (JSON format)
# Constitutional Principle VII: Observability
ENABLE_STRUCTURED_LOGGING=true

# Metrics output directory (relative to repository root)
METRICS_OUTPUT_PATH=".docs/agents/shared/metrics/"

# Track baseline metrics for comparison
# Measures pre-enhancement performance for 3.5x validation
TRACK_BASELINE_METRICS=true

# Task completion accuracy improvement target
# FR-047: 3.5x improvement over baseline
TASK_COMPLETION_IMPROVEMENT_TARGET=3.5

# ===================================================================
# Safety & Circuit Breakers
# ===================================================================

# Enable circuit breakers for agent failures
# Auto-disables agents if failure rate exceeds threshold
ENABLE_CIRCUIT_BREAKERS=true

# Circuit breaker threshold (0.0-1.0)
# Opens circuit if agent failure rate > this value
CIRCUIT_BREAKER_THRESHOLD=0.50

# Circuit breaker reset timeout (seconds)
# Time before attempting to close circuit after opening
CIRCUIT_BREAKER_RESET_TIMEOUT=300

# Enable feature flags for gradual rollout
# FR-051: Support rollback capability
ENABLE_FEATURE_FLAGS=true

# ===================================================================
# Performance Targets (from FR requirements)
# ===================================================================

# Context retrieval performance target (milliseconds)
CONTEXT_RETRIEVAL_TARGET=2000

# Debug iteration cycle target (milliseconds)
DEBUG_ITERATION_TARGET=30000

# Task completion accuracy baseline (to be measured)
# Set this after measuring current framework performance
TASK_COMPLETION_BASELINE=0.0

# ===================================================================
# Validation Configuration
# ===================================================================

# Dimension weights for verification scoring (must sum to 1.0)
# Used by Verification Agent for quality assessment
VERIFICATION_WEIGHT_COMPLETENESS=0.25
VERIFICATION_WEIGHT_CONSTITUTIONAL=0.30
VERIFICATION_WEIGHT_TEST_COVERAGE=0.25
VERIFICATION_WEIGHT_SPEC_ALIGNMENT=0.20

# ===================================================================
# Notes
# ===================================================================
# - All paths are relative to repository root
# - Boolean values: true | false (lowercase)
# - Thresholds are 0.0-1.0 floats
# - Times are in milliseconds unless specified
# - Configuration is loaded by refinement engine at startup
# - Changes require engine restart to take effect
# - See plan.md for detailed parameter explanations
